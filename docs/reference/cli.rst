CLI Reference
=============

FHOPS exposes a Typer-based CLI called ``fhops``. Detailed command documentation will be
autogenerated with ``sphinx-click`` in upcoming iterations. For now, the primary commands are:

- ``fhops validate`` — validate scenario inputs.
- ``fhops solve-mip`` — build and solve the deterministic MIP.
- ``fhops solve-heur`` — run the metaheuristic solver (simulated annealing v0.1).
- ``fhops solve-heur --iters 5000 --seed 123`` — adjust SA iteration budget/seed (additional tuning flags under review).
- ``fhops evaluate`` — replay a schedule and compute KPIs.
- ``fhops benchmark`` — compare solver runtimes and quality on a single scenario (legacy helper).
- ``fhops bench suite`` — run the full benchmarking harness across sample or user-supplied scenarios.
- ``fhops geo distances`` — derive block-to-block distance matrices from GeoJSON geometry.

Run ``fhops --help`` to inspect the full command tree.

Baseline usage:

- ``fhops solve-mip tests/fixtures/regression/regression.yaml --out /tmp/regression_mip.csv``
- ``fhops solve-heur tests/fixtures/regression/regression.yaml --out /tmp/regression_sa.csv``
- ``fhops evaluate tests/fixtures/regression/regression.yaml /tmp/regression_sa.csv``
- ``fhops bench suite --scenario examples/minitoy/scenario.yaml --out-dir tmp/benchmarks``

Both ``solve-mip`` and ``solve-heur`` export schedules with the columns ``machine_id``, ``block_id``,
``day``, and ``shift_id``. The shift identifier matches the scenario's shift calendar (or defaults to
``S1`` when only day-level data is provided) so downstream tooling can analyse sub-daily assignments.

Additional simulated annealing controls:

- ``fhops solve-heur ... --operator swap --operator move`` — restrict the operator set (defaults to all registered operators).
- ``fhops solve-heur ... --operator-weight swap=2 --operator-weight move=0.5`` — adjust operator weights; zero disables an operator.
- ``fhops bench suite ... --operator swap --operator-weight swap=2`` — pass the same options when running aggregate benchmarks; the summary now records the operator configuration in ``operators_config``.
- ``fhops solve-heur ... --operator-preset swap-only`` — apply predefined operator weight profiles (available presets: ``balanced``, ``move-only``, ``swap-heavy``, ``swap-only``, ``diversify``). Presets may be combined with explicit ``--operator`` and ``--operator-weight`` overrides.
- ``fhops bench suite --operator-preset swap-heavy --operator-weight move=1`` — use presets within benchmarking; final configurations are captured in the summary output.
- ``fhops solve-heur --list-operator-presets`` (or ``fhops bench suite --list-operator-presets``) — display all presets with their weights and descriptions.
- ``fhops solve-heur ... --telemetry-log fhops_runs.jsonl`` — append telemetry entries (objective, KPIs, operator stats) to a JSONL file for later analysis.
- ``fhops solve-heur ... --show-operator-stats`` — print per-operator proposal/acceptance statistics at the end of a run (also available in the benchmark summaries).

The evaluation output should include `mobilisation_cost=6.0` and `sequencing_violation_count=0`
if the regression baseline is satisfied.
